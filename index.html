<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lookup — URL & Numéro</title>

  <style>
    body { font-family: Arial; background:#f5f6fa; padding:40px; }
    .box { max-width:700px; margin:auto; background:white; padding:20px; border-radius:12px; box-shadow:0 4px 18px rgba(0,0,0,0.08); }
    input { width:80%; padding:12px; border-radius:8px; border:1px solid #ccc; }
    button { padding:12px 18px; border-radius:8px; border:0; background:#0066ff; color:white; cursor:pointer; }
    button:hover { opacity:0.9; }
    .result { margin-top:20px; }
    .error { color:#c0392b; font-weight:bold; }
    .snippet { background:#f0f2f7; padding:10px; border-radius:6px; white-space:pre-wrap; }
    img.favicon { width:40px; height:40px; border-radius:6px; margin-bottom:10px; }
  </style>

  <script src="https://unpkg.com/libphonenumber-js@1.9.48/bundle/libphonenumber-js.min.js"></script>
</head>
<body>

<div class="box">
  <h2>Recherche d'informations</h2>
  <p>Colle une URL ou un numéro :</p>

  <input id="query" type="text" placeholder="ex: google.com ou 0612345678">
  <button onclick="startSearch()">Rechercher</button>

  <div id="result" class="result"></div>
</div>


<script>
function isUrl(text) {
  const exp = /^(https?:\/\/)?([\w-]+\.)+[\w-]+/i;
  return exp.test(text);
}

function ensureHttp(url) {
  return url.startsWith("http") ? url : "https://" + url;
}

async function startSearch() {
  const q = document.getElementById("query").value.trim();
  const out = document.getElementById("result");
  out.innerHTML = "";

  if (!q) {
    out.innerHTML = "<p class='error'>Veuillez entrer une URL ou un numéro.</p>";
    return;
  }

  if (isUrl(q)) return lookupURL(q);
  return lookupPhone(q);
}

/* ------------------- LOOKUP URL ------------------- */
async function lookupURL(url) {
  const out = document.getElementById("result");
  const finalUrl = ensureHttp(url);

  out.innerHTML = "Analyse en cours...";

  // Proxy stable (allorigins + JSON mode)
  const api = "https://api.allorigins.win/get?url=" + encodeURIComponent(finalUrl);

  try {
    const req = await fetch(api);
    const data = await req.json();

    const html = data.contents;

    // Parse HTML
    const parser = new DOMParser();
    const doc = parser.parseFromString(html, "text/html");

    const title = doc.querySelector("title")?.innerText || "(Aucun titre)";
    const desc = doc.querySelector('meta[name=\"description\"]')?.content || "Aucune description";
    const favicon = doc.querySelector("link[rel*='icon']")?.href || finalUrl + "/favicon.ico";

    let textContent = doc.body?.innerText || "";
    textContent = textContent.replace(/\s+/g, " ").trim().slice(0, 500);

    out.innerHTML = `
      <img class="favicon" src="${favicon}" onerror="this.style.display='none'">
      <h3>${title}</h3>
      <p><strong>Description :</strong> ${desc}</p>
      <p><strong>URL :</strong> ${finalUrl}</p>
      <p><strong>Extrait :</strong></p>
      <div class="snippet">${textContent}</div>
    `;

  } catch(e) {
    out.innerHTML = `<p class="error">Impossible de récupérer cette URL (CORS / Proxy).  
    Essaie une autre URL.</p>`;
  }
}

/* ------------------- LOOKUP PHONE ------------------- */
function lookupPhone(num) {
  const out = document.getElementById("result");

  try {
    const clean = num.replace(/[\s().-]/g, "");
    const { parsePhoneNumberFromString } = libphonenumber;
    const phone = parsePhoneNumberFromString(clean, "FR");

    if (!phone) throw new Error("numéro non reconnu");

    out.innerHTML = `
      <h3>Analyse du numéro</h3>
      <p><strong>Format international :</strong> ${phone.formatInternational()}</p>
      <p><strong>Valide :</strong> ${phone.isValid() ? "Oui ✔️" : "Non ❌"}</p>
      <p><strong>Pays détecté :</strong> ${phone.country || "?"}</p>
      <p><strong>Type :</strong> ${phone.getType() || "Inconnu"}</p>
    `;
  } catch(e) {
    out.innerHTML = `<p class="error">Numéro invalide.</p>`;
  }
}
</script>

</body>
</html>
